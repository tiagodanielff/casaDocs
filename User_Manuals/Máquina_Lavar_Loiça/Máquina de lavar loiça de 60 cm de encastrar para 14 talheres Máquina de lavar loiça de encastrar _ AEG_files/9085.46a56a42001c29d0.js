"use strict";(self.webpackChunkSHELL=self.webpackChunkSHELL||[]).push([[9085,4627],{9085:function(e,t,n){n.r(t);var r=n(2807),o=n(1846),a=n.n(o),l=n(3027),u=n(2010),i=n(5020),s=n(5978),c=n(2076),d=n(3728),f=n(3797),w=n(1054),g=n.n(w),v=n(6710),h=n(7685),b=n(4627),L=n(1011),U=n(7333),S=n.n(U),m=n(273),p=n.n(m);let C=a()(()=>n.e(678).then(n.bind(n,678)).catch(()=>v.E),{loadableGenerated:{webpack:()=>[678]},ssr:!1}),P=()=>{let[e,t]=(0,l.useState)(!1),[n,o]=(0,l.useState)(""),[a,w]=(0,l.useState)((0,h.useGlobalBoundStoreInstance)().getState().userLoginStatus),v=(0,f.t)(),{modalUrl:U,language:m}=(0,h.useGlobalBoundStore)((0,u.N)(e=>{var t,n,r;return{modalUrl:(null===(t=e.settings)||void 0===t?void 0:null===(n=t.config)||void 0===n?void 0:n.modalUrl)||"",language:null===(r=e.settings)||void 0===r?void 0:r.language}})),P=(0,h.useGlobalBoundStore)((0,u.N)(e=>e.settings)),E=(0,h.useGlobalBoundStore)(e=>e.updateUserLoginStatus),k=()=>{let e=new URL(window.location.toString());e.searchParams.delete(s.OIDC_POPUP),e.searchParams.delete(s.LOGOUT_STATUS);let t=e.searchParams.get("returnUrl"),n=t||`${e.pathname}${e.search}${e.hash}`;return encodeURIComponent(n)},I=(0,l.useCallback)(async()=>{try{let e=await g().get(c.l.authentication.getLoginStatus(m||""),{credentials:"include"});if(!v)return;d.event.publish(i.uw,{data:e}),w(e),E(e)}catch(e){if(!v)return;console.error("Get user error",e)}},[v,m,E]);(0,l.useEffect)(()=>{let e=d.event.subscribe(i.Nv,async e=>{if(a)try{await O(P,e.cCv2LogoutUrl),p().remove(i.sV),p().remove(i.TJ)}catch(e){console.error("ccv2 logout and generate new CartId error",e)}finally{var t;let e=(null==a?void 0:a.oidcIsEnabled)?`${i.bO}${null===(t=a.oidcViewModel)||void 0===t?void 0:t.logoutUrl}`:(null==a?void 0:a.logoutUrl)||"",[n]=null==e?void 0:e.split("?returnUrl=");window.location.href=`${n}?returnUrl=${k()}`}});return()=>d.event.unsubscribe(e)},[P,a]),(0,l.useEffect)(()=>{let e=d.event.subscribe(i.k2,e=>{let{externalModalUrl:n,register:r}=e,a=n;a||(a=(null==U?void 0:U.split("?returnUrl=").shift())+"?returnUrl="+k()),r&&(a+="&register=true"),o(a),t(!0)});return()=>d.event.unsubscribe(e)},[U]),(0,l.useEffect)(()=>{let e=p().get(i.sV);e&&!a&&I();let t=e=>{if(e)try{let t=JSON.parse((null==e?void 0:e.data)||"");if((null==t?void 0:t.channel)===i.ko){if(null==t?void 0:t.redirectUrl){window.location.href=window.location.origin+t.redirectUrl;return}I()}}catch(e){}};return window.addEventListener(i.Qu,t),()=>window.removeEventListener(i.Qu,t)},[I]),(0,l.useEffect)(()=>{let e=(0,L.B)(s.OIDC_POPUP.toLowerCase()),t=(0,L.B)(s.LOGOUT_STATUS.toLowerCase());(function(){let e=window.localStorage.getItem(i.L9);e&&!window.location.hash&&(window.location.hash=e,window.localStorage.removeItem(i.L9))})(),e&&!t&&(d.event.publish(i.k2,{isModal:!0}),d.event.publish(b.TRACK_VIRTUAL_PAGE,{virtualPage:i.ox}))},[]);let O=async(e,t)=>{await S().handleCartBeforeLogout(e,t)};return e&&(0,r.jsx)(C,{modalUrl:n})};t.default=P},2076:function(e,t,n){n.d(t,{l:function(){return r}});class r{}r.authentication={getLoginStatus:e=>`/${e}/api/bff/getloginstatus`,getLoginIframe:e=>`${e}`}},3797:function(e,t,n){n.d(t,{t:function(){return o}});var r=n(3027);function o(){let e=(0,r.useRef)(!1);return(0,r.useEffect)(()=>(e.current=!0,()=>{e.current=!1}),[]),(0,r.useCallback)(()=>e.current,[])}},1011:function(e,t,n){n.d(t,{B:function(){return r}});function r(e){let t=new URLSearchParams(window.location.search),n=new URLSearchParams(Array.from(t,e=>{let[t,n]=e;return[t.toLocaleLowerCase(),n]}));return n.get(e)}}}]);