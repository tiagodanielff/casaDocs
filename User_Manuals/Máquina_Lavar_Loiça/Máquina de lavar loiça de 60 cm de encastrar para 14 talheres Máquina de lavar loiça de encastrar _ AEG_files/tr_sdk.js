if(!tdconvObj){var tdconvObj={c:"Tradedoubler Tracking SDK | ",element:"iframe",initSrc(){var t=document.currentScript||document.querySelector('script[src*="tr_sdk.js?"]')||document.querySelector('script[src*="trsdk?"]'),e=document.createElement("a");e.href=t.src;var r=t.src.replace(/^[^\?]+\??/,""),i=this.parseQuery(r);i.o&&(i.org=i.o),i.p&&(i.prog=i.p),this.src={host:e.hostname,params:i},this.sameHost=!e.hostname.includes(".tradedoubler.com"),this.sameHost&&this.log("Branded tracking active! Using domain:",this.src.host)},parseQuery(t){var e=new Object;if(!t)return e;for(var r=t.split(/[;&)]/),i=(r=r.filter(t=>String(t).trim()))[0]&&r[0].includes("=")?"=":"(",a=0;a<r.length;a++){var o=r[a].split(i);if(o&&2===o.length){var s=unescape(o[0]),n=unescape(o[1]);n=n.replace(/\+/g," "),e[s]=n}}return e},getQueryStringParam(t){try{var e=new URLSearchParams(window.location.search).get(t)}catch(r){try{e=this.getUrlParameter(t)}catch(t){return!1}}return e},getUrlParameter(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},setVar(t,e){if(null!==e){this.log("Saving: ",t," => ",e);try{this.setCookie(t,e,!0)}catch(t){}finally{this.setCookie(t,e),window.localStorage.setItem(t,e)}}},getVar(t){var e=this.getCookie(t);return e?("tduid"===t&&e.indexOf("?")>0&&(e=e.substr(0,e.indexOf("?"))),e):window.localStorage.getItem(t)?window.localStorage.getItem(t):""},removeVar(t){try{this.setCookie(t,"",!0,!0)}catch(t){this.log(t)}finally{this.setCookie(t,"",!1,!0),window.localStorage.removeItem(t)}},setTduid(t){if(t&&this.getConsent("cookie")&&this.getConsent("tracking"))if(this.sameHost){this.log(" > creating first party cookie server side...");var e=(new Date).valueOf(),r=this.getHost()+"/statics/"+t+"?t="+e;this.createEl("img",{src:r,alt:""}),window.localStorage.setItem("tduid",t)}else this.setVar("tduid",t)},setCookie(t,e,r,i){var a="";if(r){var o=window.location.host,s=o.substring(o.indexOf("."));(s.match(/\./g).length<2||".co"===s.substring(0,s.indexOf(".",1)))&&(s="."+o),a=`domain=${s}`}var n=new Date,d=!0===i?1e3:n.getTime()+31536e6;n.setTime(d);var c="expires="+n.toUTCString();document.cookie=`${t}=${e};${c};${a};path=/;sameSite=none;Secure=true`},getCookie(t){t+="=";for(var e=document.cookie.split(";"),r=0;r<e.length;r++){try{var i=decodeURIComponent(e[r])}catch(t){this.log("Cannot URIDecode: "+e[r]+t.message);continue}for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return!1},setConsent(t,e,r){"cookie"!==t&&"tracking"!==t||"boolean"!=typeof e||(this.log(t+" consent "+(e?"GRANTED":"DENIED!")),window.localStorage.setItem(this.storageVars[t],e),!1===e&&this.getVar("tduid")&&this.removeVar("tduid"),e&&r&&this.initLanding())},getConsent(t){var e=!0;return"cookie"!==t&&"tracking"!==t||!window.localStorage.getItem(this.storageVars[t])||(e="false"!==window.localStorage.getItem(this.storageVars[t])),e},getConsParameter(t){return!1===this.getConsent("cookie")||!1===this.getConsent("tracking")?!0===t?"cons(false)":"&cons=false":""},setDebug(t){if(t=Number(t),[0,1,2].includes(t)){var e=0!==t?"Enabled":"Disabled";console.log(this.c+`Debug Mode ${e} (${t})!`),0===t?window.localStorage.removeItem("tddebug"):window.localStorage.setItem("tddebug",t)}},getDebug:()=>Number(window.localStorage.getItem("tddebug")),log(...t){this.getDebug()>0&&console.log(this.c,...t)},getHost(t){if(this.sameHost&&!0===this.sameHost)return"https://"+this.src.host;var e=".tradedoubler.com";switch(t){case"clk":return"https://clk"+e;case"lead":return"https://tbl"+e;case"ct":return"https://swrap"+e;default:return"https://tbs"+e}},validateExtType(t){return!!/^[0-1]{1}$/gi.test(t)||(console.warn(this.c+"The extType for Cross Device Tracking is not valid, only 0 or 1 are valid values, please review: extType = "+t),!1)},validateExtIdHash(t){return!!/^[A-F0-9]{64}$/gi.test(t)||(console.warn(this.c+"The extId for Cross Device Tracking is not a valid SHA-256 Hash, please review: extId = "+t),!1)},validateValidOn(t){if(/^\d{4}\-\d{2}\-\d{2}$/.test(t)){var e=new Date(t);if(e.getTime())return this.log("Comparing validOn: "+e.getTime()+" To now: "+(new Date).getTime()),!(e.getTime()<(new Date).getTime())||(console.warn(this.c+"ValidOn date in past: "+t),!1)}return console.warn(this.c+"ValidOn date not valid, please review: validOn = "+t),!1},validateEventTime(t){if(/^\d{4}\-\d{2}\-\d{2}\%20\d{2}\:\d{2}\:\d{2}$/.test(t)){t=t.replace("%20"," ");var e=new Date(t);if(e.getTime()){this.log("Comparing eventTime: "+e.getTime()+" To now: "+(new Date).getTime());var r=new Date;return r.setFullYear(r.getFullYear()-1),e.getTime()>(new Date).getTime()?(console.warn(this.c+"EventTime date in future: "+t),!1):!(e.getTime()<r.getTime())||(console.warn(this.c+"EventTime date older than one year in the past: "+t),!1)}}return console.warn(this.c+"EventTime not valid: "+t),!1},generateRandomOrderNumber:()=>(new Date).valueOf()+""+Math.round(1e3*Math.random())+"auto",initLanding(){var t,e=this.getQueryStringParam("tdclid_sn");if("true"===this.getQueryStringParam("td_consent")&&e&&this.setVar("tdclid_sn",e),(t=this.getQueryStringParam("deviceid")?this.getQueryStringParam("deviceid"):this.getQueryStringParam("tduid"))&&(this.setTduid(t),!e&&this.getVar("tdclid_sn")&&this.getConsent("cookie")&&this.getConsent("tracking")&&this.removeVar("tdclid_sn")),this.getDebug()&&window.setTimeout(()=>{this.log(" > test read first party cookie:",'"'+this.getVar("tduid")+'"',this.getVar("tduid")?"âœ”ï¸":"ðŸš«")},1e3),this.getQueryStringParam("progId"))var r=this.getQueryStringParam("progId");else if(this.getQueryStringParam("prog"))r=this.getQueryStringParam("prog");if(void 0!==r&&this.setVar("tdprog",r),this.getQueryStringParam("affId"))var i=this.getQueryStringParam("affId");else if(this.getQueryStringParam("aff"))i=this.getQueryStringParam("aff");void 0!==i&&this.setVar("tdaff",i),"string"==typeof this.getQueryStringParam("directLink")&&this.fireTDClk()},createEl(t,e){var r="width:1px;height:1px;border:0;";e&&Object.hasOwn(e,"style")?e.style+=r:e.style=r;var i=document.createElement(t);for(let t in e)i[t]=e[t];document.body?document.body.appendChild(i):document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(i)})},fireTDClk(){var t="Direct link clk aborted.";if(!1!==this.getConsent("tracking")){if(this.getVar("tdprog"))var e=this.getVar("tdprog");else{if(!this.programId)return void this.log(t+"No programId found.");e=this.programId}if(this.getVar("tdaff")){var r=this.getVar("tdaff"),i=this.getHost("clk")+"/click?p="+e+"&a="+r+"&f=0";i+=this.getConsParameter(),this.getDebug()>0&&(this.log("Debug Mode! Direct link clk URL: "+i),1===this.getDebug())||this.createEl("iframe",{src:i,async:!0,id:"tdClk"})}else this.log(t+"No affId found.")}else this.log(t+"Tracking consent not granted.")},fireTDTag(t,e,r,i){if(e+=this.getConsParameter(i),this.abhost="a.imgstatics.com",void 0===window.tdfallback&&("lead"===t||"sale"===t)&&1!==this.getDebug())try{var a=document.createElement("a");a.href=e;var o=e.replace(a.hostname,this.abhost);void 0!==(o+=!0===i?"f(0)convtagtid(24)":"&f=0&convtagtid=24")&&(window.tdfallback=window.setTimeout(()=>{fetch(o,{keepalive:!0,mode:"no-cors"}).then(t=>this.bc=!0).catch(t=>t)},1e3))}catch(t){this.log("Fallback request error. "+t)}var s=33,n=23;this.gtm_mode&&(s=32,n=22),"iframe"===r?e+=!0===i?"type(iframe)convtagtid("+s+")":"&type=iframe&convtagtid="+s:"img"===r&&(e+=!0===i?"convtagtid("+n+")":"&convtagtid="+n);var d=window.google_tag_manager?"true":"false";e+=!0===i?`gtm_loaded(${d})`:`&gtm_loaded=${d}`;var c=this.getCookie("_ga")?"true":"false";e+=!0===i?`ga_loaded(${c})`:`&ga_loaded=${c}`,this.getDebug()>0&&(this.log("Debug Mode! Element: "+r+"! Event: "+t+"! URL: "+e),1===this.getDebug())||this.createEl(this.element,{src:e,async:!0,onload:()=>{this.px=!0,this.log("Conversion deployed")}})},getPLTQuery(t,e){var r=this.generateRandomOrderNumber(),i="",a="",o="",s="",n="",d="",c="",g="",h="enc(3)",l="",u=this.getVar("tdclid_sn");if(void 0!==t.transactionId&&(r=t.transactionId),void 0!==t.currency&&(i=t.currency),void 0!==t.voucher&&(a="voucher("+t.voucher+")"),void 0!==t.enc&&(h="enc("+t.enc+")"),void 0!==t.eventTime&&this.validateEventTime(t.eventTime)&&(d="event_time("+t.eventTime+")"),void 0!==t.validOn&&this.validateValidOn(t.validOn)&&(o="validOn("+t.validOn+")"),void 0!==t.cdt&&this.validateExtType(t.cdt.extType)&&this.validateExtIdHash(t.cdt.extId)&&(s="extid("+t.cdt.extId+")",n="exttype("+t.cdt.extType+")"),void 0!==t.ttid&&(c=`ttid(${t.ttid})`),void 0!==t.trafficSource&&(g=`trafficSource(${encodeURIComponent(t.trafficSource)})`),void 0!==t.basket)l=t.basket;else{if(!(Array.isArray(t.products)&&t.products.length>0))return console.warn(this.c+"Products basket is missing!"),null;l="basket(";for(let e=0;e<t.products.length;e++)void 0!==t.products[e].currency&&t.products[e].currency!==t.currency&&console.warn(this.c+"Product currency mismatch! Product currency: "+t.products[e].currency+" is different than the currency of transaction: "+t.currency+". Using "+t.currency),l+="pr(",l+="i("+encodeURIComponent(t.products[e].id.substr(0,20))+")",l+="n("+encodeURIComponent(t.products[e].name.replace(/[()]+/g,"").substr(0,20))+")",l+="gr("+t.products[e].grpId+")",l+="v("+t.products[e].price+")",l+="q("+t.products[e].qty+")",l+=")";l+=")"}var m="";return this.program?m+=`p(${this.programId})`:!1===e&&(m+=`p(${this.getVar("tdprog")})`),!1===e&&this.getVar("tdaff")&&(m+=`a(${this.getVar("tdaff")})`),m+=`o(${this.orgId})event(${t.event})ordnum(${r})curr(${i})`+a+d+o+c+g,!1!==e&&(m+=s+n+"tduid("+this.getVar("tduid")+")"),u&&(m+=`tdpeh(${u})`),m+=h+l},trackEvent(t,e){this.isConv=!0;var r=this.getConsent("tracking"),i=this.getVar("tdprog"),a=this.getVar("tdaff"),o=this.getVar("tdclid_sn");if(!1!==r||i&&a||o){var s=!1,n="",d=this.getHost(t)+"/report?",c="",g="",h="",l="",u="",m="",v="",p="";if(void 0!==e.voucher&&(c="&voucher="+e.voucher),void 0!==e.validOn&&this.validateValidOn(e.validOn)&&(g="&validOn="+e.validOn),void 0!==e.cdt&&this.validateExtType(e.cdt.extType)&&this.validateExtIdHash(e.cdt.extId)&&(h="&extid="+e.cdt.extId,l="&exttype="+e.cdt.extType),void 0!==e.eventTime&&this.validateEventTime(e.eventTime)&&(u="&event_time="+e.eventTime),void 0!==e.ttid&&(m="&ttid="+e.ttid),void 0!==e.trafficSource&&(v="&trafficSource="+encodeURIComponent(e.trafficSource)),void 0!==e.reportInfo)p=e.reportInfo;else if(Array.isArray(e.products)&&e.products.length>0){for(var f=0,b=[];f<e.products.length;f++)b.push("f1="+e.products[f].id+"&f2="+e.products[f].name+"&f3="+e.products[f].price+"&f4="+e.products[f].qty);p=encodeURIComponent(b.join("|"))}if(n=d,this.program?n+="program="+this.programId+"&":!1===r&&(n+="program="+i+"&"),!1===r&&a&&(n+="affiliate="+a+"&"),"lead"===t){if(!e.transactionId)return void console.warn(this.c+"Lead aborted. TransactionId is missing.");var y=4;void 0!==e.event&&(y=e.event),n+=`organization=${this.orgId}&event=${y}&leadnumber=${e.transactionId}`+c+u+g+m+v}else if("sale"===t&&void 0!==e.event&&Number(e.event)>=51&&Number(e.event)<=55)s=!0,n=d+this.getPLTQuery(e,r);else if("sale"===t){if(!e.transactionId&&!e.ordervalue)return void console.warn(this.c+"Sale aborted. TransactionId and order value are missing.");var w=this.generateRandomOrderNumber(),I=(y=5,0),k="";void 0!==e.transactionId&&(w=e.transactionId),void 0!==e.event&&(y=e.event),void 0!==e.ordervalue?I=e.ordervalue:void 0!==e.orderValue&&(I=e.orderValue),void 0!==e.currency&&(k=e.currency),n+=`organization=${this.orgId}&event=${y}&ordervalue=${I}&ordernumber=${w}&currency=${k}`+c+u+g+m+v}!1===s&&(!1!==r&&(n+=h+l+"&tduid="+this.getVar("tduid")),o&&(n+="&tdpeh="+o),n+="&reportInfo="+p),this.fireTDTag(t,n,this.element,s),("sale"===t||s)&&this.abCheck(e)}else console.warn(this.c+"Conversion aborted. Tracking consent not granted.")},abCheck(t){var e="td"+this.generateRandomOrderNumber();this.createEl("div",{id:e,className:"ad-wrap",style:"background:transparent;display:block;visibility:hidden;"}),window.tdabc=window.setTimeout(()=>{var r=document.getElementById(e),i=!!r&&"block"!==window.getComputedStyle(r).display;if(this.px&&i){var a=`https://${this.abhost}/report?program=357281&affiliate=132234&event=446022&orderNumber=${t.event}_${t.transactionId}&orderValue=${t.ordervalue}&currency=${t.currency}&convtagtid=24&reportInfo=`+encodeURIComponent(`f1=${t.transactionId}&f2=${this.orgId}&f3=&f4=${t.event}`);fetch(a,{keepalive:!0,mode:"no-cors"}).then(t=>{}).catch(t=>{})}},2e3)},initContainer(){if(this.orgId){var t=this.getHost("ct")+"/wrap?org="+this.orgId;this.programId&&(t+="&prog="+this.programId),this.isConv&&(t+="&case=conversion"),t+=this.getConsParameter(),this.getDebug()>0&&(this.log("Debug Mode! Default container URL: "+t),1===this.getDebug())||this.createEl("script",{src:t,async:!0})}else this.log("OrgId missing for default container.")},initConfig(t){this.orgId&&Number(this.orgId)!==Number(t.organization)&&console.warn(this.c+"orgId mismatch: JS src = ",this.orgId,", init = ",t.organization),this.orgId=t.organization,"img"===t.element&&(this.element="img"),t.program?(this.programId&&Number(this.programId)!==Number(t.programId)&&console.warn(this.c+"programId mismatch: JS src = ",this.programId,", init = ",t.programId),this.program=!0,this.programId=t.programId):this.program=!1},processQueue(t,e){switch(this.log(`Processing step "${t[0]}"...`),e=!0===e,t[0]){case"debug":this.setDebug(t[1]);break;case"cookie-consent":this.setConsent("cookie",t[1],e);break;case"tracking-consent":this.setConsent("tracking",t[1],e);break;case"landing":this.initLanding();break;case"container":this.initContainer();break;case"init":"object"==typeof t[1]?this.initConfig(t[1]):null!==typeof t[2]?"object"==typeof t[2]?(t[2].organization=t[1],this.initConfig(t[2])):this.initConfig(JSON.parse(t[2])):this.initConfig({organization:t[1]});break;case"track":this.trackEvent(t[1],t[2])}},initSrcParams(){this.src.params.org&&(this.orgId=this.src.params.org),this.src.params.prog&&(this.program=!0,this.programId=this.src.params.prog),this.src.params.v&&this.src.params.v.indexOf("gtm")>=0&&(this.gtm_mode=!0)},init(){var t=this.getQueryStringParam("_td_debug");if(t&&this.setDebug(t),this.initSrc(),this.initSrcParams(),this.gtm_mode)this.log("GTM mode active");else{var e=[];tdconv&&tdconv.q&&(e=tdconv.q),e.push({0:"landing"}),e.push({0:"container"}),e.sort((t,e)=>{var r={debug:0,"cookie-consent":1,"tracking-consent":2,init:3,landing:4,track:5,container:6};return r[t[0]]>r[e[0]]?1:r[t[0]]<r[e[0]]?-1:0}),e.forEach(t=>this.processQueue(t))}},storageVars:{cookie:"tdcookieconsent",tracking:"tdtrackingconsent"}};tdconvObj.init();var tdconv=function(t,e,r){tdconvObj.processQueue([t,e,r],!0)}}